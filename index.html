<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="description" content="TRAci Clinical Innovation Platform - Secure Pneumology Research Management">
    <title>TRAci | Pneumology Innovation</title>
    
    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <style>
        /* ===== COMPLETE CSS ===== */
        :root {
            /* Professional Color Palette - Healthcare Focus */
            --primary-50: #f0f9ff;
            --primary-100: #e0f2fe;
            --primary-200: #bae6fd;
            --primary-300: #7dd3fc;
            --primary-400: #38bdf8;
            --primary-500: #0ea5e9;
            --primary-600: #0284c7;
            --primary-700: #0369a1;
            --primary-800: #075985;
            --primary-900: #0c4a6e;
            
            /* Secondary colors - medical teal family */
            --teal-50: #f0fdfa;
            --teal-100: #ccfbf1;
            --teal-500: #14b8a6;
            --teal-600: #0d9488;
            --teal-700: #0f766e;
            
            /* Neutral palette */
            --neutral-50: #f9fafb;
            --neutral-100: #f3f4f6;
            --neutral-200: #e5e7eb;
            --neutral-300: #d1d5db;
            --neutral-400: #9ca3af;
            --neutral-500: #6b7280;
            --neutral-600: #4b5563;
            --neutral-700: #374151;
            --neutral-800: #1f2937;
            --neutral-900: #111827;
            
            /* Semantic colors */
            --success-50: #f0fdf4;
            --success-500: #22c55e;
            --success-600: #16a34a;
            --warning-50: #fefce8;
            --warning-500: #eab308;
            --warning-600: #ca8a04;
            --danger-50: #fef2f2;
            --danger-500: #ef4444;
            --danger-600: #dc2626;
            --info-50: #eff6ff;
            --info-500: #3b82f6;
            --info-600: #2563eb;
            
            /* Application colors */
            --bg-primary: var(--neutral-50);
            --bg-secondary: var(--neutral-100);
            --bg-card: #ffffff;
            --border-light: var(--neutral-200);
            --border: var(--neutral-300);
            --border-dark: var(--neutral-400);
            --text-primary: var(--neutral-900);
            --text-secondary: var(--neutral-600);
            --text-muted: var(--neutral-500);
            
            /* Fonts */
            --font-sans: 'Inter', sans-serif;
            --font-heading: 'Space Grotesk', sans-serif;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            
            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            
            /* Border radius */
            --radius-sm: 6px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #0f172a;
                --bg-secondary: #1e293b;
                --bg-card: #334155;
                --border-light: #475569;
                --border: #64748b;
                --border-dark: #94a3b8;
                --text-primary: #f1f5f9;
                --text-secondary: #cbd5e1;
                --text-muted: #94a3b8;
            }
        }

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: var(--space-md);
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 300px;
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--teal-600) 100%);
            opacity: 0.03;
            z-index: -1;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }

        /* ===== UTILITY CLASSES ===== */
        .hidden { display: none !important; }
        .visible { display: block !important; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .items-end { align-items: flex-end; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-end { justify-content: flex-end; }
        .gap-2 { gap: var(--space-sm); }
        .gap-4 { gap: var(--space-md); }
        .gap-6 { gap: var(--space-lg); }
        .gap-8 { gap: var(--space-xl); }
        .w-full { width: 100%; }
        .w-auto { width: auto; }
        .h-full { height: 100%; }
        .mb-2 { margin-bottom: var(--space-sm); }
        .mb-4 { margin-bottom: var(--space-md); }
        .mb-6 { margin-bottom: var(--space-lg); }
        .mb-8 { margin-bottom: var(--space-xl); }
        .mt-2 { margin-top: var(--space-sm); }
        .mt-4 { margin-top: var(--space-md); }
        .mt-6 { margin-top: var(--space-lg); }
        .mt-8 { margin-top: var(--space-xl); }
        .p-3 { padding: var(--space-lg); }
        .p-4 { padding: var(--space-md); }
        .p-6 { padding: var(--space-lg); }
        .p-8 { padding: var(--space-xl); }
        .rounded-sm { border-radius: var(--radius-sm); }
        .rounded-md { border-radius: var(--radius-md); }
        .rounded-lg { border-radius: var(--radius-lg); }
        .rounded-xl { border-radius: var(--radius-xl); }
        .rounded-full { border-radius: var(--radius-full); }
        .border { border: 1px solid var(--border); }
        .shadow-sm { box-shadow: var(--shadow-sm); }
        .shadow { box-shadow: var(--shadow); }
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }
        .cursor-pointer { cursor: pointer; }
        .select-none { user-select: none; }
        .transition { transition: var(--transition); }
        .transition-colors { transition: color var(--transition), background-color var(--transition), border-color var(--transition); }
        .transition-transform { transition: transform var(--transition); }
        .opacity-0 { opacity: 0; }
        .opacity-50 { opacity: 0.5; }
        .opacity-100 { opacity: 1; }
        .scale-90 { transform: scale(0.9); }
        .scale-100 { transform: scale(1); }
        .scale-110 { transform: scale(1.1); }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from { 
                transform: translateY(20px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from { 
                transform: translateX(20px);
                opacity: 0;
            }
            to { 
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .animate-fadeIn {
            animation: fadeIn 0.3s ease-in-out;
        }

        .animate-slideInUp {
            animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        /* ===== LOGIN PAGE REDESIGN ===== */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--teal-50) 100%);
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 80%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(14, 165, 233, 0.05), transparent);
            transform: rotate(45deg);
        }

        .login-card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            width: 100%;
            max-width: 420px;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-light);
            position: relative;
            z-index: 1;
            animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .login-header {
            text-align: center;
            margin-bottom: var(--space-2xl);
        }

        .login-logo {
            width: 72px;
            height: 72px;
            margin: 0 auto var(--space-lg);
            background: linear-gradient(135deg, var(--primary-500), var(--teal-600));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
        }

        .login-logo-icon {
            font-size: 32px;
            color: white;
        }

        .login-title {
            font-family: var(--font-heading);
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
            background: linear-gradient(135deg, var(--primary-600), var(--teal-600));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .form-group {
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-xs);
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            font-size: 15px;
            font-family: var(--font-sans);
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            transition: all var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.15);
            background: var(--bg-card);
        }

        .form-input::placeholder {
            color: var(--text-muted);
            opacity: 0.7;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 36px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: var(--radius-sm);
            transition: color var(--transition);
        }

        .password-toggle:hover {
            color: var(--primary-500);
            background: var(--primary-50);
        }

        .remember-forgot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            margin-top: -8px;
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            cursor: pointer;
        }

        .remember-checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-radius: 4px;
            background: var(--bg-primary);
            cursor: pointer;
            position: relative;
            transition: all var(--transition);
        }

        .remember-checkbox.checked {
            background: var(--primary-500);
            border-color: var(--primary-500);
        }

        .remember-checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            top: -1px;
            left: 2px;
            color: white;
            font-size: 12px;
        }

        .forgot-link {
            color: var(--primary-600);
            text-decoration: none;
            font-weight: 600;
            transition: color var(--transition);
        }

        .forgot-link:hover {
            color: var(--primary-700);
            text-decoration: underline;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
        }

        .login-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--primary-700), var(--primary-800));
        }

        .login-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .login-divider {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin: var(--space-lg) 0;
            color: var(--text-muted);
            font-size: 14px;
        }

        .login-divider::before,
        .login-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .login-footer {
            text-align: center;
            margin-top: var(--space-xl);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--border-light);
            color: var(--text-muted);
            font-size: 13px;
        }

        .login-footer a {
            color: var(--primary-600);
            text-decoration: none;
            font-weight: 600;
        }

        .login-footer a:hover {
            text-decoration: underline;
        }

        /* ===== DASHBOARD HEADER ===== */
        .header {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
            padding: var(--space-xl) 0;
            margin-bottom: var(--space-xl);
            border-bottom: 2px solid var(--border-light);
        }

        @media (min-width: 768px) {
            .header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }

        .logo {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary-500), var(--teal-600));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .logo::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
        }

        .logo-icon {
            font-size: 24px;
            color: white;
        }

        .platform-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .platform-name {
            font-family: var(--font-heading);
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }

        .department-name {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 600;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }

        .header-right {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
            width: 100%;
        }

        @media (min-width: 768px) {
            .header-right {
                flex-direction: row;
                align-items: center;
                justify-content: flex-end;
                width: auto;
                gap: var(--space-xl);
            }
        }

        /* Status Panel */
        .status-panel {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-full);
            padding: 10px 20px;
            box-shadow: var(--shadow-sm);
            min-height: 44px;
            justify-content: center;
            width: 100%;
        }

        @media (min-width: 768px) {
            .status-panel {
                width: auto;
            }
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 700;
            color: var(--success-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background-color: var(--success-600);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* User Profile */
        .user-profile {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 12px 16px;
            width: 100%;
            justify-content: space-between;
            transition: all var(--transition);
            box-shadow: var(--shadow-sm);
            min-height: 60px;
        }

        .user-profile:hover {
            box-shadow: var(--shadow);
            border-color: var(--primary-300);
        }

        @media (min-width: 768px) {
            .user-profile {
                width: auto;
                justify-content: flex-start;
                padding: 8px 16px;
            }
        }

        .user-info-wrapper {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            flex: 1;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--primary-500), var(--teal-500));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-role {
            font-size: 11px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: var(--radius-full);
            width: fit-content;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .user-role.admin { 
            background: var(--danger-50);
            color: var(--danger-600);
            border: 1px solid var(--danger-200);
        }
        .user-role.doctor { 
            background: var(--primary-50);
            color: var(--primary-700);
            border: 1px solid var(--primary-200);
        }
        .user-role.researcher { 
            background: var(--teal-50);
            color: var(--teal-700);
            border: 1px solid var(--teal-200);
        }
        .user-role.guest { 
            background: var(--neutral-100);
            color: var(--neutral-600);
            border: 1px solid var(--neutral-300);
        }

        .user-actions {
            display: flex;
            gap: 4px;
        }

        .user-action-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 6px;
            border-radius: var(--radius-sm);
            transition: all var(--transition);
            min-width: 32px;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-action-btn:hover {
            background: var(--neutral-100);
            color: var(--text-primary);
        }

        .logout-btn:hover {
            color: var(--danger-600);
            background: var(--danger-50);
        }

        /* ===== MOBILE OPTIMIZATION ===== */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius-md);
        }

        .mobile-nav {
            position: fixed;
            top: 0;
            right: -280px;
            width: 280px;
            height: 100vh;
            background: var(--bg-card);
            border-left: 1px solid var(--border);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            padding: var(--space-xl);
            transition: transform var(--transition);
            overflow-y: auto;
        }

        .mobile-nav.open {
            transform: translateX(-280px);
        }

        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--border);
        }

        .mobile-nav-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: var(--radius-sm);
        }

        .mobile-nav-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
            
            .header-right {
                display: none;
            }
            
            .user-profile {
                flex-direction: column;
                align-items: stretch;
            }
            
            .user-info-wrapper {
                justify-content: space-between;
            }
            
            .admin-controls {
                flex-direction: column;
            }
            
            .admin-btn {
                width: 100%;
                justify-content: center;
            }
            
            .filter-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .filter-btn {
                flex: 1;
                min-width: 120px;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .project-actions {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
            }
            
            .feedback-channels {
                justify-content: center;
            }
        }

        /* ===== ADMIN CONTROLS ===== */
        .admin-controls {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
            flex-wrap: wrap;
            padding: var(--space-md);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .admin-btn {
            padding: 10px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .admin-btn:hover {
            border-color: var(--primary-500);
            color: var(--primary-600);
            background: var(--primary-50);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* ===== STATS CONTAINER ===== */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            transition: all var(--transition);
            min-height: 100px;
            box-shadow: var(--shadow-sm);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-300);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            flex-shrink: 0;
        }

        .stat-icon.tools { background: var(--primary-500); }
        .stat-icon.projects { background: var(--teal-500); }
        .stat-icon.comments { background: var(--info-500); }
        .stat-icon.users { background: var(--warning-500); }
        .stat-icon.sync { background: var(--danger-500); }

        .stat-info {
            flex: 1;
        }

        .stat-info h3 {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .stat-number {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--text-primary);
            font-family: var(--font-heading);
            line-height: 1;
        }

        /* ===== FILTER CONTROLS ===== */
        .filter-controls {
            display: flex;
            gap: 8px;
            margin-bottom: var(--space-xl);
            flex-wrap: wrap;
            background: var(--bg-card);
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        .filter-btn {
            padding: 8px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-full);
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-btn:hover {
            background: var(--primary-50);
            color: var(--primary-600);
            border-color: var(--primary-300);
        }

        .filter-btn.active {
            background: var(--primary-500);
            color: white;
            border-color: var(--primary-500);
            box-shadow: var(--shadow-sm);
        }

        /* ===== CONTENT GRID ===== */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-xl);
            margin-bottom: var(--space-xl);
        }

        @media (min-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* ===== SECTION STYLING ===== */
        .section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition);
        }

        .section:hover {
            box-shadow: var(--shadow);
        }

        .section-header {
            padding: var(--space-lg);
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .section-header h2 {
            font-family: var(--font-heading);
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-content {
            padding: var(--space-lg);
        }

        /* ===== TOOLS GRID ===== */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-md);
        }

        .tool-card {
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            transition: all var(--transition);
            display: flex;
            flex-direction: column;
            background: var(--bg-card);
            gap: var(--space-md);
        }

        .tool-card:hover {
            border-color: var(--primary-300);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .tool-header {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
        }

        .tool-icon-wrapper {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--primary-500), var(--teal-500));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .tool-name {
            font-weight: 600;
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .tool-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: var(--radius-full);
            font-weight: 700;
            white-space: nowrap;
            border: 1px solid;
            margin-left: auto;
        }

        .tool-status.operational { 
            background: var(--success-50);
            color: var(--success-600);
            border-color: var(--success-200);
        }
        .tool-status.warning { 
            background: var(--warning-50);
            color: var(--warning-600);
            border-color: var(--warning-200);
        }
        .tool-status.maintenance { 
            background: var(--info-50);
            color: var(--info-600);
            border-color: var(--info-200);
        }

        .tool-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
            flex-grow: 1;
        }

        .tool-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tool-link {
            color: var(--primary-600);
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all var(--transition);
        }

        .tool-link:hover {
            color: var(--primary-700);
            text-decoration: underline;
        }

        .tool-category {
            font-size: 12px;
            color: var(--text-muted);
            padding: 4px 8px;
            background: var(--neutral-100);
            border-radius: var(--radius-sm);
            font-weight: 600;
        }

        /* ===== PROJECTS LIST ===== */
        .projects-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .project-card {
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            transition: all var(--transition);
            background: var(--bg-card);
            position: relative;
        }

        .project-card:hover {
            border-color: var(--primary-300);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-md);
            flex-wrap: wrap;
            gap: 8px;
        }

        .project-title {
            font-weight: 600;
            font-size: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .project-status {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
            border: 1px solid;
        }

        .status-planning { 
            background: var(--neutral-100);
            color: var(--neutral-600);
            border-color: var(--neutral-300);
        }
        .status-development { 
            background: var(--primary-50);
            color: var(--primary-600);
            border-color: var(--primary-200);
        }
        .status-testing { 
            background: var(--warning-50);
            color: var(--warning-600);
            border-color: var(--warning-200);
        }
        .status-production { 
            background: var(--success-50);
            color: var(--success-600);
            border-color: var(--success-200);
        }
        .status-archived { 
            background: var(--neutral-100);
            color: var(--neutral-600);
            border-color: var(--neutral-300);
        }

        .project-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: var(--space-lg);
            line-height: 1.6;
            padding: var(--space-md);
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--primary-300);
        }

        /* Progress Bar */
        .project-progress {
            margin-bottom: var(--space-lg);
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--neutral-200);
            border-radius: var(--radius-full);
            overflow: hidden;
            width: 100%;
        }

        .progress-fill {
            height: 100%;
            border-radius: var(--radius-full);
            background: linear-gradient(90deg, var(--primary-500), var(--teal-500));
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Project Actions */
        .project-actions {
            display: flex;
            gap: 8px;
            margin-top: var(--space-lg);
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 16px;
            border-radius: var(--radius-md);
            border: 1px solid;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            flex: 1;
            min-width: 80px;
            justify-content: center;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .edit-btn {
            background: var(--primary-50);
            color: var(--primary-700);
            border-color: var(--primary-200);
        }

        .edit-btn:hover {
            background: var(--primary-100);
            border-color: var(--primary-300);
        }

        .delete-btn {
            background: var(--danger-50);
            color: var(--danger-600);
            border-color: var(--danger-200);
        }

        .delete-btn:hover {
            background: var(--danger-100);
            border-color: var(--danger-300);
        }

        .comment-btn {
            background: var(--info-50);
            color: var(--info-600);
            border-color: var(--info-200);
        }

        .comment-btn:hover {
            background: var(--info-100);
            border-color: var(--info-300);
        }

        /* ===== MODAL STYLES ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            margin: auto;
            animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border);
        }

        .modal-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 1;
        }

        .modal-header h3 {
            font-family: var(--font-heading);
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-close {
            background: transparent;
            border: none;
            font-size: 24px;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: var(--radius-sm);
            transition: all var(--transition);
        }

        .modal-close:hover {
            background: var(--neutral-100);
            color: var(--danger-600);
        }

        .modal-body {
            padding: var(--space-lg);
        }

        /* ===== FORM STYLES ===== */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
        }

        @media (max-width: 640px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
            line-height: 1.5;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        /* ===== NOTIFICATIONS ===== */
        .notification-badge {
            position: relative;
        }

        .notification-count {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--danger-500);
            color: white;
            font-size: 10px;
            font-weight: 700;
            min-width: 18px;
            height: 18px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            border: 2px solid var(--bg-card);
        }

        /* ===== ACTIVITY DASHBOARD ===== */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
        }

        .activity-icon {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            background: var(--primary-100);
            color: var(--primary-600);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .activity-details {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* ===== MESSAGES ===== */
        .message {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-md);
            display: none;
            border-left: 4px solid;
        }

        .message.error {
            background: var(--danger-50);
            color: var(--danger-600);
            border-left-color: var(--danger-500);
        }

        .message.success {
            background: var(--success-50);
            color: var(--success-600);
            border-left-color: var(--success-500);
        }

        .message.warning {
            background: var(--warning-50);
            color: var(--warning-600);
            border-left-color: var(--warning-500);
        }

        .message.info {
            background: var(--info-50);
            color: var(--info-600);
            border-left-color: var(--info-500);
        }

        /* ===== LOADING STATES ===== */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--neutral-300);
            border-top-color: var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .skeleton {
            background: linear-gradient(90deg, var(--neutral-200) 25%, var(--neutral-100) 50%, var(--neutral-200) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-sm);
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ===== FOOTER ===== */
        .footer {
            text-align: center;
            padding: var(--space-xl) 0;
            color: var(--text-muted);
            font-size: 13px;
            border-top: 1px solid var(--border);
            margin-top: var(--space-xl);
        }

        /* ===== RESPONSIVE ADJUSTMENTS ===== */
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            
            .login-card {
                padding: var(--space-xl);
                margin: var(--space-md);
            }
            
            .header {
                padding: var(--space-lg) 0;
            }
            
            .platform-name {
                font-size: 20px;
            }
            
            .section-content {
                padding: var(--space-md);
            }
            
            .modal-content {
                max-width: 100%;
                margin: 0;
            }
            
            .modal-overlay {
                padding: 0;
            }
        }

        @media (max-width: 480px) {
            .platform-name {
                font-size: 18px;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .login-title {
                font-size: 24px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--neutral-100);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--neutral-400);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--neutral-500);
        }
    </style>
</head>
<body>
    <!-- Main Container -->
    <div class="container">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn hidden" id="mobileMenuBtn">
            <i class="mdi mdi-menu"></i>
        </button>

        <!-- Mobile Navigation -->
        <div class="mobile-nav" id="mobileNav">
            <div class="mobile-nav-header">
                <h3>Menu</h3>
                <button class="mobile-nav-close" id="mobileNavClose">
                    <i class="mdi mdi-close"></i>
                </button>
            </div>
            <div class="mobile-nav-content" id="mobileNavContent">
                <!-- Mobile content will be populated by JavaScript -->
            </div>
        </div>

        <!-- Header -->
        <header class="header" id="dashboardHeader">
            <div class="logo-section">
                <div class="logo">
                    <i class="mdi mdi-heart-pulse logo-icon"></i>
                </div>
                <div class="platform-info">
                    <h1 class="platform-name">TRAci</h1>
                    <p class="department-name">Pneumology Innovation</p>
                </div>
            </div>
            
            <div class="header-right" id="headerRight">
                <!-- Status Panel -->
                <div class="status-panel hidden" id="statusPanel">
                    <span>Updated: <strong id="lastUpdatedTime">--:--</strong></span>
                    <span class="live-indicator">
                        <span class="live-dot"></span> LIVE
                    </span>
                </div>
                
                <!-- Notification Bell -->
                <div class="notification-badge hidden" id="notificationBadge">
                    <button class="user-action-btn" id="notificationsBtn" title="Notifications">
                        <i class="mdi mdi-bell"></i>
                    </button>
                    <span class="notification-count hidden" id="notificationCount">0</span>
                </div>
                
                <!-- User Profile -->
                <div class="user-profile hidden" id="userProfile">
                    <div class="user-info-wrapper">
                        <div class="user-avatar" id="userAvatar"></div>
                        <div class="user-info">
                            <span class="user-name" id="currentUsername"></span>
                            <span class="user-role" id="currentUserRole"></span>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="user-action-btn" id="activityBtn" title="Activity">
                            <i class="mdi mdi-chart-line"></i>
                        </button>
                        <button class="user-action-btn logout-btn" id="logoutBtn" title="Logout">
                            <i class="mdi mdi-logout"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Auth Button -->
                <button id="loginBtn" class="login-btn hidden" style="max-width: 120px;">
                    <i class="mdi mdi-login"></i>
                    <span>Login</span>
                </button>
            </div>
        </header>

        <!-- Guest Welcome -->
        <div id="guestWelcome" class="hidden">
            <div class="section">
                <div class="section-content">
                    <div style="text-align: center; padding: var(--space-2xl) var(--space-xl);">
                        <div style="font-size: 48px; color: var(--primary-300); margin-bottom: var(--space-lg);">
                            <i class="mdi mdi-hand-wave"></i>
                        </div>
                        <h2 style="font-family: var(--font-heading); margin-bottom: var(--space-md); color: var(--text-primary);">
                            Welcome to TRAci Platform!
                        </h2>
                        <p style="max-width: 500px; margin: 0 auto var(--space-xl); color: var(--text-secondary); line-height: 1.7;">
                            You're viewing our clinical innovation portfolio. Explore tools, review projects, and engage with our research community. 
                            Guest users can comment and view public projects.
                        </p>
                        <div style="display: flex; gap: var(--space-md); justify-content: center; flex-wrap: wrap;">
                            <button id="guestContactBtn" class="login-btn" style="background: var(--teal-600); max-width: 160px;">
                                <i class="mdi mdi-email-send"></i>
                                <span>Contact Team</span>
                            </button>
                            <button id="guestLearnBtn" class="login-btn" style="max-width: 160px;">
                                <i class="mdi mdi-book-open-variant"></i>
                                <span>Learn More</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Controls -->
        <div class="admin-controls hidden" id="adminControls">
            <button class="admin-btn" id="addProjectBtn">
                <i class="mdi mdi-plus-circle"></i>
                <span>Add Project</span>
            </button>
            <button class="admin-btn" id="addToolBtn">
                <i class="mdi mdi-toolbox"></i>
                <span>Add Tool</span>
            </button>
            <button class="admin-btn" id="manageUsersBtn">
                <i class="mdi mdi-account-multiple"></i>
                <span>Manage Users</span>
            </button>
            <button class="admin-btn" id="syncProjectsBtn">
                <i class="mdi mdi-sync"></i>
                <span>Sync Projects</span>
            </button>
            <button class="admin-btn" id="viewCodesBtn">
                <i class="mdi mdi-key-chain"></i>
                <span>Edit Codes</span>
            </button>
            <button class="admin-btn" id="moderateCommentsBtn">
                <i class="mdi mdi-comment-processing"></i>
                <span>Moderate</span>
            </button>
            <button class="admin-btn" id="activityDashboardBtn">
                <i class="mdi mdi-chart-bar"></i>
                <span>Activity</span>
            </button>
        </div>

        <!-- Stats Overview -->
        <div class="stats-container hidden" id="statsContainer">
            <div class="stat-card">
                <div class="stat-icon tools">
                    <i class="mdi mdi-toolbox"></i>
                </div>
                <div class="stat-info">
                    <h3>Active Tools</h3>
                    <div class="stat-number" id="toolsCount">0</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon projects">
                    <i class="mdi mdi-flask-outline"></i>
                </div>
                <div class="stat-info">
                    <h3>Research Projects</h3>
                    <div class="stat-number" id="projectsCount">0</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon comments">
                    <i class="mdi mdi-comment-multiple"></i>
                </div>
                <div class="stat-info">
                    <h3>Total Comments</h3>
                    <div class="stat-number" id="commentsCount">0</div>
                </div>
            </div>
            <div class="stat-card hidden" id="usersCard">
                <div class="stat-icon users">
                    <i class="mdi mdi-shield-account"></i>
                </div>
                <div class="stat-info">
                    <h3>Active Users</h3>
                    <div class="stat-number" id="usersCount">0</div>
                </div>
            </div>
        </div>

        <!-- Filter Controls -->
        <div class="filter-controls hidden" id="filterControls">
            <button class="filter-btn active" data-filter="all">
                <i class="mdi mdi-view-grid"></i>
                <span>All Projects</span>
            </button>
            <button class="filter-btn" data-filter="needs_review">
                <i class="mdi mdi-alert-circle"></i>
                <span>Needs Review</span>
            </button>
            <button class="filter-btn" data-filter="proposals">
                <i class="mdi mdi-lightbulb-on"></i>
                <span>Proposals</span>
            </button>
            <button class="filter-btn" data-filter="imported">
                <i class="mdi mdi-import"></i>
                <span>Imported</span>
            </button>
            <button class="filter-btn" data-filter="published">
                <i class="mdi mdi-share-variant"></i>
                <span>Published</span>
            </button>
            <button class="filter-btn" data-filter="private">
                <i class="mdi mdi-lock"></i>
                <span>Private</span>
            </button>
            <button class="filter-btn" data-filter="public">
                <i class="mdi mdi-earth"></i>
                <span>Public</span>
            </button>
            <button class="filter-btn" data-filter="most_commented">
                <i class="mdi mdi-comment-multiple"></i>
                <span>Most Comments</span>
            </button>
        </div>

        <!-- Main Content -->
        <div class="content-grid hidden" id="contentGrid">
            <!-- Tools Section -->
            <div class="section">
                <div class="section-header">
                    <h2>
                        <i class="mdi mdi-toolbox"></i>
                        <span>Clinical Tools & Resources</span>
                    </h2>
                </div>
                <div class="section-content">
                    <div class="tools-grid" id="toolsGrid">
                        <!-- Tools loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Projects Section -->
            <div class="section">
                <div class="section-header">
                    <h2>
                        <i class="mdi mdi-flask"></i>
                        <span>Research & Innovation Projects</span>
                    </h2>
                    <span style="font-size: 13px; color: var(--text-muted); font-weight: 600;" id="projectsCountBadge">
                        <i class="mdi mdi-counter"></i> 0 projects
                    </span>
                </div>
                <div class="section-content">
                    <div class="projects-list" id="projectsList">
                        <!-- Projects loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Required -->
        <div class="login-required hidden" id="loginRequiredSection">
            <div class="section">
                <div class="section-content">
                    <div style="text-align: center; padding: var(--space-2xl) var(--space-xl);">
                        <div style="font-size: 48px; color: var(--primary-300); margin-bottom: var(--space-lg);">
                            <i class="mdi mdi-shield-lock-outline"></i>
                        </div>
                        <h2 style="font-family: var(--font-heading); margin-bottom: var(--space-md); color: var(--text-primary);">
                            Secure Clinical Innovation Dashboard
                        </h2>
                        <p style="max-width: 500px; margin: 0 auto var(--space-xl); color: var(--text-secondary); line-height: 1.7;">
                            Access to the TRAci Clinical Innovation Platform is restricted to authorized healthcare personnel only. 
                            All accounts must be created and authorized by the system administrator.
                        </p>
                        <button id="loginRequiredBtn" class="login-btn" style="max-width: 200px; margin: 0 auto;">
                            <i class="mdi mdi-login"></i>
                            <span>Login to Continue</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>
                <strong>TRAci Clinical Innovation Platform</strong> v3.0 â€¢ 
                <a href="#" id="refreshLink" style="color: var(--primary-600); text-decoration: none; font-weight: 600;">
                    <i class="mdi mdi-refresh"></i>
                    <span>Refresh Data</span>
                </a>
            </p>
            <p style="margin-top: 4px; font-size: 12px; color: var(--text-muted);">
                Secure â€¢ HIPAA Compliant â€¢ Audit Logged
            </p>
            <p style="margin-top: 4px; font-size: 11px; color: var(--text-muted); opacity: 0.8;">
                Session expires in: <span id="sessionTimer">--:--</span>
            </p>
        </footer>
    </div>

    <!-- ===== MODALS ===== -->
    
    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-shield-lock-outline"></i>
                    <span>Secure Login</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message error" id="loginError"></div>
                <div class="message success" id="loginSuccess"></div>
                
                <div class="login-form">
                    <div class="form-group">
                        <label for="loginEmail">
                            <i class="mdi mdi-email"></i>
                            Email Address
                        </label>
                        <input type="email" id="loginEmail" class="form-input" 
                               placeholder="Enter your email" autocomplete="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">
                            <i class="mdi mdi-key"></i>
                            Password
                        </label>
                        <input type="password" id="loginPassword" class="form-input" 
                               placeholder="Enter your password" autocomplete="current-password" required>
                        <button type="button" class="password-toggle" id="togglePassword">
                            <i class="mdi mdi-eye"></i>
                        </button>
                    </div>
                    
                    <div class="remember-forgot">
                        <label class="remember-me">
                            <div class="remember-checkbox" id="rememberCheckbox"></div>
                            <span>Remember me</span>
                        </label>
                        <a href="#" class="forgot-link" id="forgotPasswordLink">Forgot password?</a>
                    </div>
                    
                    <button id="submitLogin" class="login-btn">
                        <i class="mdi mdi-login"></i>
                        <span>Sign In</span>
                    </button>
                    
                    <div class="login-divider">
                        <span>Need access?</span>
                    </div>
                    
                    <div style="text-align: center; font-size: 13px; color: var(--text-muted);">
                        <p>Contact administrator at <strong>admin@pneumology.hospital</strong></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-lock-reset"></i>
                    <span>Reset Password</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message error" id="forgotError"></div>
                <div class="message success" id="forgotSuccess"></div>
                
                <div class="login-form">
                    <div class="form-group">
                        <label for="forgotEmail">
                            <i class="mdi mdi-email"></i>
                            Email Address
                        </label>
                        <input type="email" id="forgotEmail" class="form-input" 
                               placeholder="Enter your email address" required>
                    </div>
                    
                    <div style="background: var(--warning-50); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-md);">
                        <p style="font-size: 13px; color: var(--warning-600); margin: 0;">
                            <i class="mdi mdi-information"></i>
                            A password reset link will be sent to your email. Check your spam folder if you don't see it.
                        </p>
                    </div>
                    
                    <button id="submitForgot" class="login-btn" style="background: var(--teal-600);">
                        <i class="mdi mdi-send"></i>
                        <span>Send Reset Link</span>
                    </button>
                    
                    <div style="text-align: center; margin-top: var(--space-md);">
                        <a href="#" class="forgot-link" id="backToLogin">Back to login</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="resetPasswordModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-key-change"></i>
                    <span>Set New Password</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message error" id="resetError"></div>
                <div class="message success" id="resetSuccess"></div>
                
                <div class="login-form">
                    <input type="hidden" id="resetToken">
                    
                    <div class="form-group">
                        <label for="newPassword">
                            <i class="mdi mdi-key"></i>
                            New Password
                        </label>
                        <input type="password" id="newPassword" class="form-input" 
                               placeholder="Enter new password" required>
                        <button type="button" class="password-toggle" id="toggleNewPassword">
                            <i class="mdi mdi-eye"></i>
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">
                            <i class="mdi mdi-key-plus"></i>
                            Confirm Password
                        </label>
                        <input type="password" id="confirmPassword" class="form-input" 
                               placeholder="Confirm new password" required>
                    </div>
                    
                    <div style="background: var(--info-50); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-md);">
                        <p style="font-size: 12px; color: var(--info-600); margin: 0;">
                            <i class="mdi mdi-shield-check"></i>
                            Password must be at least 12 characters with uppercase, lowercase, numbers, and symbols.
                        </p>
                    </div>
                    
                    <button id="submitReset" class="login-btn" style="background: var(--success-600);">
                        <i class="mdi mdi-check-circle"></i>
                        <span>Update Password</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-bell"></i>
                    <span>Notifications</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="activity-list" id="notificationsList">
                    <!-- Notifications loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Dashboard Modal -->
    <div id="activityModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-chart-line"></i>
                    <span>User Activity Dashboard</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; gap: var(--space-md); margin-bottom: var(--space-lg);">
                    <div style="flex: 1; background: var(--bg-primary); padding: var(--space-md); border-radius: var(--radius-md);">
                        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Total Logins</div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--text-primary);" id="totalLogins">0</div>
                    </div>
                    <div style="flex: 1; background: var(--bg-primary); padding: var(--space-md); border-radius: var(--radius-md);">
                        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Active Sessions</div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--text-primary);" id="activeSessions">0</div>
                    </div>
                    <div style="flex: 1; background: var(--bg-primary); padding: var(--space-md); border-radius: var(--radius-md);">
                        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Locked Accounts</div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--text-primary);" id="lockedAccounts">0</div>
                    </div>
                </div>
                
                <div style="margin-bottom: var(--space-lg);">
                    <h4 style="margin-bottom: var(--space-md); font-size: 14px; color: var(--text-primary); font-weight: 600;">
                        <i class="mdi mdi-history"></i>
                        Recent Activity
                    </h4>
                    <div class="activity-list" id="activityList">
                        <!-- Activity loaded dynamically -->
                    </div>
                </div>
                
                <div>
                    <h4 style="margin-bottom: var(--space-md); font-size: 14px; color: var(--text-primary); font-weight: 600;">
                        <i class="mdi mdi-account-clock"></i>
                        Long Sessions (>30 min)
                    </h4>
                    <div class="activity-list" id="longSessionsList">
                        <!-- Long sessions loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div id="addProjectModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-plus-circle"></i>
                    <span>Add New Project</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message error" id="projectError"></div>
                <div class="message success" id="projectSuccess"></div>
                
                <div class="login-form">
                    <div class="form-group">
                        <label for="projectName">Project Name *</label>
                        <input type="text" id="projectName" class="form-input" 
                               placeholder="Enter project name" maxlength="200" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectDescription">Description</label>
                        <textarea id="projectDescription" class="form-input" 
                                  placeholder="Detailed project description..." rows="4"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectStatus">Status</label>
                            <select id="projectStatus" class="form-input">
                                <option value="planning">Planning</option>
                                <option value="development" selected>Development</option>
                                <option value="testing">Testing</option>
                                <option value="production">Production</option>
                                <option value="archived">Archived</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="projectProgress">Progress (%)</label>
                            <input type="number" id="projectProgress" class="form-input" 
                                   min="0" max="100" value="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectCategory">Category</label>
                            <select id="projectCategory" class="form-input">
                                <option value="clinical_research">Clinical Research</option>
                                <option value="quality_improvement">Quality Improvement</option>
                                <option value="technology">Technology</option>
                                <option value="education">Education</option>
                                <option value="administrative">Administrative</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="projectPriority">Priority</label>
                            <select id="projectPriority" class="form-input">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="projectNeedsFeedback" style="width: 16px; height: 16px;">
                            <span style="font-weight: 600; font-size: 14px;">Mark for Clinical Review</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectVisibility">Visibility</label>
                        <select id="projectVisibility" class="form-input">
                            <option value="public">Public (Visible to all users)</option>
                            <option value="private">Private (Clinical team only)</option>
                            <option value="admin_only">Admin Only</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectOwner">Project Owner</label>
                        <input type="text" id="projectOwner" class="form-input" 
                               placeholder="Name of lead clinician">
                    </div>
                    
                    <button id="saveProjectBtn" class="login-btn">
                        <i class="mdi mdi-content-save"></i>
                        <span>Create Project</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Project Modal -->
    <div id="editProjectModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-pencil"></i>
                    <span>Edit Project</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message error" id="editProjectError"></div>
                <div class="message success" id="editProjectSuccess"></div>
                
                <input type="hidden" id="editProjectId">
                
                <div class="login-form">
                    <!-- Edit form fields (similar to add project) -->
                    <div class="form-group">
                        <label for="editProjectName">Project Name *</label>
                        <input type="text" id="editProjectName" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editProjectDescription">Description</label>
                        <textarea id="editProjectDescription" class="form-input" rows="4"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editProjectStatus">Status</label>
                            <select id="editProjectStatus" class="form-input">
                                <option value="planning">Planning</option>
                                <option value="development">Development</option>
                                <option value="testing">Testing</option>
                                <option value="production">Production</option>
                                <option value="archived">Archived</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editProjectProgress">Progress (%)</label>
                            <input type="number" id="editProjectProgress" class="form-input" 
                                   min="0" max="100">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md); margin-top: var(--space-lg);">
                        <button id="updateProjectBtn" class="login-btn">
                            <i class="mdi mdi-content-save"></i>
                            <span>Update</span>
                        </button>
                        <button id="deleteProjectBtn" class="login-btn" style="background: var(--danger-600);">
                            <i class="mdi mdi-delete"></i>
                            <span>Delete</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Tool Modal -->
    <div id="addToolModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-toolbox"></i>
                    <span>Add New Tool</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message error" id="toolError"></div>
                <div class="message success" id="toolSuccess"></div>
                
                <div class="login-form">
                    <div class="form-group">
                        <label for="toolName">Tool Name *</label>
                        <input type="text" id="toolName" class="form-input" 
                               placeholder="Enter tool name" maxlength="200" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="toolDescription">Description</label>
                        <textarea id="toolDescription" class="form-input" 
                                  placeholder="Detailed tool description..." rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="toolUrl">URL *</label>
                        <input type="url" id="toolUrl" class="form-input" 
                               placeholder="https://tool.example.com" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="toolStatus">Status</label>
                            <select id="toolStatus" class="form-input">
                                <option value="operational">Operational</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="deprecated">Deprecated</option>
                                <option value="beta">Beta</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="toolCategory">Category</label>
                            <select id="toolCategory" class="form-input">
                                <option value="clinical">Clinical Tools</option>
                                <option value="research">Research Tools</option>
                                <option value="administrative">Administrative</option>
                                <option value="educational">Educational</option>
                                <option value="general">General</option>
                            </select>
                        </div>
                    </div>
                    
                    <button id="saveToolBtn" class="login-btn">
                        <i class="mdi mdi-content-save"></i>
                        <span>Save Tool</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Users Modal -->
    <div id="manageUsersModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-account-multiple"></i>
                    <span>User Management</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: var(--space-lg);">
                    <button id="addUserBtn" class="login-btn" style="background: var(--success-600); max-width: 150px;">
                        <i class="mdi mdi-account-plus"></i>
                        <span>Add New User</span>
                    </button>
                </div>
                
                <div class="form-group">
                    <input type="text" id="userSearch" class="form-input" 
                           placeholder="Search users by name, email, or role...">
                </div>
                
                <div style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border); border-radius: var(--radius-md);">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--bg-primary);">
                                <th style="padding: var(--space-md); text-align: left; font-size: 12px; font-weight: 600; color: var(--text-muted); border-bottom: 1px solid var(--border);">User</th>
                                <th style="padding: var(--space-md); text-align: left; font-size: 12px; font-weight: 600; color: var(--text-muted); border-bottom: 1px solid var(--border);">Role</th>
                                <th style="padding: var(--space-md); text-align: left; font-size: 12px; font-weight: 600; color: var(--text-muted); border-bottom: 1px solid var(--border);">Status</th>
                                <th style="padding: var(--space-md); text-align: left; font-size: 12px; font-weight: 600; color: var(--text-muted); border-bottom: 1px solid var(--border);">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit User Modal -->
    <div id="userFormModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-account-plus"></i>
                    <span id="userFormTitle">Add New User</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message error" id="userError"></div>
                <div class="message success" id="userSuccess"></div>
                
                <input type="hidden" id="editUserId">
                
                <div class="login-form">
                    <div class="form-group">
                        <label for="userFullName">Full Name *</label>
                        <input type="text" id="userFullName" class="form-input" 
                               placeholder="Enter full name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="userEmail">Email Address *</label>
                        <input type="email" id="userEmail" class="form-input" 
                               placeholder="email@hospital.com" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="userRole">Role *</label>
                            <select id="userRole" class="form-input">
                                <option value="admin">Administrator</option>
                                <option value="doctor">Doctor/Clinician</option>
                                <option value="researcher">Researcher</option>
                                <option value="guest">Guest (Read-only)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="userDepartment">Department</label>
                            <select id="userDepartment" class="form-input">
                                <option value="pulmonology">Pulmonology</option>
                                <option value="cardiology">Cardiology</option>
                                <option value="neurology">Neurology</option>
                                <option value="research">Research</option>
                                <option value="administration">Administration</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="userPassword">Password *</label>
                        <div style="display: flex; gap: var(--space-md); align-items: center;">
                            <input type="text" id="userPassword" class="form-input" 
                                   placeholder="Auto-generated password" readonly>
                            <button type="button" id="generatePasswordBtn" class="login-btn" style="padding: 10px; background: var(--info-600);">
                                <i class="mdi mdi-refresh"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="userIsActive" checked style="width: 16px; height: 16px;">
                            <span style="font-weight: 600; font-size: 14px;">Active Account</span>
                        </label>
                    </div>
                    
                    <button id="saveUserBtn" class="login-btn">
                        <i class="mdi mdi-content-save"></i>
                        <span id="saveUserBtnText">Create User</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Comments Modal -->
    <div id="commentsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-comment-multiple"></i>
                    <span id="commentsModalTitle">Project Comments</span>
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message error" id="commentError"></div>
                <div class="message success" id="commentSuccess"></div>
                
                <!-- Comment form -->
                <div id="commentFormSection" class="hidden">
                    <div class="form-group">
                        <label for="commentText">Add a comment</label>
                        <textarea id="commentText" class="form-input" 
                                  placeholder="Share your thoughts, feedback, or questions..." rows="3"
                                  maxlength="1000"></textarea>
                        <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                            <small id="commentHint" style="color: var(--text-muted); font-size: 12px;">
                                <i class="mdi mdi-information"></i>
                                <span id="commentHintText"></span>
                            </small>
                            <span id="commentCharCount" style="font-size: 12px; color: var(--text-muted); font-weight: 600;">0/1000</span>
                        </div>
                    </div>
                    
                    <button id="submitCommentBtn" class="login-btn">
                        <i class="mdi mdi-send"></i>
                        <span>Post Comment</span>
                    </button>
                </div>
                
                <!-- Comments list -->
                <div id="commentsList" style="margin-top: var(--space-lg); max-height: 300px; overflow-y: auto;">
                    <!-- Comments loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Session Timeout Warning -->
    <div id="sessionTimeoutModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-timer-alert"></i>
                    <span>Session Timeout Warning</span>
                </h3>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: var(--space-lg);">
                    <div style="font-size: 48px; color: var(--warning-500); margin-bottom: var(--space-md);">
                        <i class="mdi mdi-clock-alert"></i>
                    </div>
                    <h3 style="margin-bottom: var(--space-md); color: var(--text-primary);">Your session is about to expire</h3>
                    <p style="color: var(--text-secondary); margin-bottom: var(--space-lg);">
                        You will be logged out in <span id="timeoutCountdown">5:00</span> due to inactivity.
                    </p>
                    <div style="display: flex; gap: var(--space-md); justify-content: center;">
                        <button id="extendSessionBtn" class="login-btn">
                            <i class="mdi mdi-refresh"></i>
                            <span>Stay Logged In</span>
                        </button>
                        <button id="logoutNowBtn" class="login-btn" style="background: var(--danger-600);">
                            <i class="mdi mdi-logout"></i>
                            <span>Logout Now</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Account Locked Modal -->
    <div id="accountLockedModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>
                    <i class="mdi mdi-lock-alert"></i>
                    <span>Account Locked</span>
                </h3>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: var(--space-lg);">
                    <div style="font-size: 48px; color: var(--danger-500); margin-bottom: var(--space-md);">
                        <i class="mdi mdi-shield-lock"></i>
                    </div>
                    <h3 style="margin-bottom: var(--space-md); color: var(--text-primary);">Account Temporarily Locked</h3>
                    <p style="color: var(--text-secondary); margin-bottom: var(--space-lg);">
                        Too many failed login attempts. Your account has been locked for security reasons.
                    </p>
                    <p style="color: var(--text-muted); font-size: 14px;">
                        Please contact the system administrator to reactivate your account.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ========== CONFIGURATION ==========
        const SUPABASE_URL = 'https://bledpouekiytppuhxeqq.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_zdlIM8UbOrRIFpmYLJOmWQ_4QqNi_5C';
        
        // Session configuration
        const SESSION_TIMEOUT = 30 * 60 * 1000; // 30 minutes
        const SESSION_WARNING = 5 * 60 * 1000; // 5 minutes warning
        const MAX_LOGIN_ATTEMPTS = 3;
        const LOCKOUT_DURATION = 15 * 60 * 1000; // 15 minutes

        // ========== STATE MANAGEMENT ==========
        let currentUser = null;
        let authToken = null;
        let sessionTimer = null;
        let warningTimer = null;
        let loginAttempts = 0;
        let lastActivity = Date.now();
        let rememberMe = false;
        
        let dashboardData = {
            projects: [],
            tools: [],
            users: [],
            filteredProjects: [],
            activities: [],
            notifications: []
        };

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            initApplication();
            setupEventListeners();
            checkSession();
        });

        function initApplication() {
            // Check for stored session
            const storedSession = localStorage.getItem('traci_session');
            const storedToken = localStorage.getItem('traci_token');
            const storedRemember = localStorage.getItem('traci_remember');
            
            if (storedSession && storedToken && storedRemember === 'true') {
                try {
                    currentUser = JSON.parse(storedSession);
                    authToken = storedToken;
                    rememberMe = true;
                    updateAuthUI();
                    startSessionTimer();
                    loadDashboard();
                } catch (e) {
                    console.error('Error parsing stored session:', e);
                    clearStoredSession();
                }
            } else {
                showLoginPage();
            }
        }

        function showLoginPage() {
            // Show login interface
            document.getElementById('dashboardHeader').classList.add('hidden');
            document.getElementById('guestWelcome').classList.add('hidden');
            document.getElementById('loginRequiredSection').classList.add('hidden');
            document.getElementById('statsContainer').classList.add('hidden');
            document.getElementById('contentGrid').classList.add('hidden');
            document.getElementById('filterControls').classList.add('hidden');
            document.getElementById('adminControls').classList.add('hidden');
            
            // Show login button
            document.getElementById('loginBtn').classList.remove('hidden');
        }

        // ========== SESSION MANAGEMENT ==========
        function checkSession() {
            if (!currentUser) return;
            
            const now = Date.now();
            const timeSinceLastActivity = now - lastActivity;
            
            if (timeSinceLastActivity > SESSION_TIMEOUT) {
                logoutUser('Session expired due to inactivity');
                return;
            }
            
            if (timeSinceLastActivity > (SESSION_TIMEOUT - SESSION_WARNING)) {
                showSessionWarning();
            }
        }

        function startSessionTimer() {
            if (sessionTimer) clearInterval(sessionTimer);
            if (warningTimer) clearTimeout(warningTimer);
            
            lastActivity = Date.now();
            
            // Update session timer every minute
            sessionTimer = setInterval(updateSessionTimer, 60000);
            
            // Show warning 5 minutes before timeout
            warningTimer = setTimeout(showSessionWarning, SESSION_TIMEOUT - SESSION_WARNING);
        }

        function updateSessionTimer() {
            if (!currentUser) return;
            
            const now = Date.now();
            const timeLeft = SESSION_TIMEOUT - (now - lastActivity);
            
            if (timeLeft <= 0) {
                logoutUser('Session expired');
                return;
            }
            
            const minutes = Math.floor(timeLeft / 60000);
            const seconds = Math.floor((timeLeft % 60000) / 1000);
            document.getElementById('sessionTimer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function showSessionWarning() {
            if (!currentUser) return;
            
            const modal = document.getElementById('sessionTimeoutModal');
            const countdown = document.getElementById('timeoutCountdown');
            
            let timeLeft = 5 * 60; // 5 minutes in seconds
            countdown.textContent = '5:00';
            
            const countdownInterval = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                countdown.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    logoutUser('Session expired');
                }
            }, 1000);
            
            showModal('sessionTimeoutModal');
            
            document.getElementById('extendSessionBtn').onclick = function() {
                clearInterval(countdownInterval);
                lastActivity = Date.now();
                startSessionTimer();
                hideAllModals();
            };
            
            document.getElementById('logoutNowBtn').onclick = function() {
                clearInterval(countdownInterval);
                logoutUser('User logged out');
            };
        }

        function updateActivity() {
            lastActivity = Date.now();
            if (currentUser && !sessionTimer) {
                startSessionTimer();
            }
        }

        // ========== AUTHENTICATION ==========
        async function loginUser(email, password) {
            const errorEl = document.getElementById('loginError');
            const successEl = document.getElementById('loginSuccess');
            const submitBtn = document.getElementById('submitLogin');
            
            // Clear messages
            errorEl.style.display = 'none';
            successEl.style.display = 'none';
            
            // Validate inputs
            if (!email || !password) {
                showError(errorEl, 'Please enter both email and password');
                return false;
            }
            
            // Check login attempts
            const attempts = parseInt(localStorage.getItem(`login_attempts_${email}`)) || 0;
            const lastAttempt = parseInt(localStorage.getItem(`last_attempt_${email}`)) || 0;
            const now = Date.now();
            
            if (attempts >= MAX_LOGIN_ATTEMPTS && (now - lastAttempt) < LOCKOUT_DURATION) {
                showError(errorEl, 'Account locked. Too many failed attempts. Please try again later or contact administrator.');
                showModal('accountLockedModal');
                return false;
            }
            
            // Show loading state
            submitBtn.innerHTML = '<span class="loading"></span>';
            submitBtn.disabled = true;
            
            try {
                // Simulate API call - replace with actual Supabase authentication
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Mock user data - replace with actual authentication
                const mockUsers = {
                    'admin@hospital.com': { password: 'Admin123!', role: 'admin', name: 'System Administrator' },
                    'doctor@hospital.com': { password: 'Doctor123!', role: 'doctor', name: 'Dr. Smith' },
                    'researcher@hospital.com': { password: 'Researcher123!', role: 'researcher', name: 'Jane Researcher' }
                };
                
                if (mockUsers[email] && mockUsers[email].password === password) {
                    // Successful login
                    currentUser = {
                        id: email.split('@')[0],
                        email: email,
                        name: mockUsers[email].name,
                        role: mockUsers[email].role,
                        department: 'Pulmonology'
                    };
                    
                    // Generate token
                    authToken = btoa(JSON.stringify({
                        email: email,
                        timestamp: Date.now()
                    }));
                    
                    // Store session if remember me is checked
                    if (rememberMe) {
                        localStorage.setItem('traci_session', JSON.stringify(currentUser));
                        localStorage.setItem('traci_token', authToken);
                        localStorage.setItem('traci_remember', 'true');
                    }
                    
                    // Reset login attempts
                    localStorage.removeItem(`login_attempts_${email}`);
                    localStorage.removeItem(`last_attempt_${email}`);
                    
                    // Log activity
                    logActivity('login', 'User logged in');
                    
                    // Update UI
                    updateAuthUI();
                    startSessionTimer();
                    loadDashboard();
                    
                    // Show success message
                    showSuccess(successEl, 'Login successful!');
                    setTimeout(() => {
                        hideAllModals();
                    }, 1000);
                    
                    return true;
                } else {
                    // Failed login
                    const newAttempts = attempts + 1;
                    localStorage.setItem(`login_attempts_${email}`, newAttempts.toString());
                    localStorage.setItem(`last_attempt_${email}`, now.toString());
                    
                    if (newAttempts >= MAX_LOGIN_ATTEMPTS) {
                        showError(errorEl, 'Account locked due to too many failed attempts. Please contact administrator.');
                        showModal('accountLockedModal');
                        logActivity('account_locked', `Account locked for ${email}`);
                        
                        // Send email notification (simulated)
                        sendEmailNotification(
                            'admin@hospital.com',
                            'Account Locked Alert',
                            `User ${email} has been locked out due to ${MAX_LOGIN_ATTEMPTS} failed login attempts.`
                        );
                    } else {
                        showError(errorEl, `Invalid email or password. ${MAX_LOGIN_ATTEMPTS - newAttempts} attempts remaining.`);
                    }
                    
                    return false;
                }
                
            } catch (error) {
                console.error('Login error:', error);
                showError(errorEl, 'Login failed. Please try again.');
                return false;
            } finally {
                submitBtn.innerHTML = '<i class="mdi mdi-login"></i><span>Sign In</span>';
                submitBtn.disabled = false;
            }
        }

        function logoutUser(reason = 'User logged out') {
            // Log activity
            if (currentUser) {
                logActivity('logout', reason);
            }
            
            // Clear session
            currentUser = null;
            authToken = null;
            rememberMe = false;
            
            // Clear timers
            if (sessionTimer) clearInterval(sessionTimer);
            if (warningTimer) clearTimeout(warningTimer);
            sessionTimer = null;
            warningTimer = null;
            
            // Clear stored session
            clearStoredSession();
            
            // Update UI
            updateAuthUI();
            showLoginPage();
            
            // Hide any open modals
            hideAllModals();
            
            // Show logout message
            showNotification('Logged out successfully', 'info');
        }

        function clearStoredSession() {
            localStorage.removeItem('traci_session');
            localStorage.removeItem('traci_token');
            localStorage.removeItem('traci_remember');
        }

        // ========== PASSWORD RESET ==========
        async function forgotPassword(email) {
            const errorEl = document.getElementById('forgotError');
            const successEl = document.getElementById('forgotSuccess');
            const submitBtn = document.getElementById('submitForgot');
            
            // Clear messages
            errorEl.style.display = 'none';
            successEl.style.display = 'none';
            
            // Validate email
            if (!email || !email.includes('@')) {
                showError(errorEl, 'Please enter a valid email address');
                return false;
            }
            
            // Show loading state
            submitBtn.innerHTML = '<span class="loading"></span>';
            submitBtn.disabled = true;
            
            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Generate reset token
                const resetToken = generateToken();
                
                // Store reset token (in real app, store in database)
                localStorage.setItem(`reset_token_${email}`, JSON.stringify({
                    token: resetToken,
                    expires: Date.now() + (24 * 60 * 60 * 1000) // 24 hours
                }));
                
                // Send email (simulated)
                sendPasswordResetEmail(email, resetToken);
                
                // Show success message
                showSuccess(successEl, 'Password reset link sent to your email. Check your inbox (and spam folder).');
                
                // Log activity
                logActivity('password_reset_requested', `Password reset requested for ${email}`);
                
                return true;
                
            } catch (error) {
                console.error('Password reset error:', error);
                showError(errorEl, 'Failed to send reset link. Please try again.');
                return false;
            } finally {
                submitBtn.innerHTML = '<i class="mdi mdi-send"></i><span>Send Reset Link</span>';
                submitBtn.disabled = false;
            }
        }

        async function resetPassword(token, newPassword, confirmPassword) {
            const errorEl = document.getElementById('resetError');
            const successEl = document.getElementById('resetSuccess');
            const submitBtn = document.getElementById('submitReset');
            
            // Clear messages
            errorEl.style.display = 'none';
            successEl.style.display = 'none';
            
            // Validate inputs
            if (!newPassword || !confirmPassword) {
                showError(errorEl, 'Please enter and confirm your new password');
                return false;
            }
            
            if (newPassword !== confirmPassword) {
                showError(errorEl, 'Passwords do not match');
                return false;
            }
            
            if (!validatePassword(newPassword)) {
                showError(errorEl, 'Password must be at least 12 characters with uppercase, lowercase, numbers, and symbols');
                return false;
            }
            
            // Show loading state
            submitBtn.innerHTML = '<span class="loading"></span>';
            submitBtn.disabled = true;
            
            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // In real app, verify token and update password in database
                // For demo, we'll just show success
                
                // Show success message
                showSuccess(successEl, 'Password updated successfully! You can now login with your new password.');
                
                // Log activity
                logActivity('password_reset', 'Password reset completed');
                
                // Hide modal after delay
                setTimeout(() => {
                    hideAllModals();
                    showModal('loginModal');
                }, 2000);
                
                return true;
                
            } catch (error) {
                console.error('Password reset error:', error);
                showError(errorEl, 'Failed to reset password. Please try again.');
                return false;
            } finally {
                submitBtn.innerHTML = '<i class="mdi mdi-check-circle"></i><span>Update Password</span>';
                submitBtn.disabled = false;
            }
        }

        function validatePassword(password) {
            const minLength = 12;
            const hasUpperCase = /[A-Z]/.test(password);
            const hasLowerCase = /[a-z]/.test(password);
            const hasNumbers = /\d/.test(password);
            const hasSymbols = /[!@#$%^&*(),.?":{}|<>]/.test(password);
            
            return password.length >= minLength && 
                   hasUpperCase && 
                   hasLowerCase && 
                   hasNumbers && 
                   hasSymbols;
        }

        function generateToken() {
            return Math.random().toString(36).substring(2) + 
                   Date.now().toString(36) + 
                   Math.random().toString(36).substring(2);
        }

        // ========== EMAIL NOTIFICATIONS ==========
        function sendEmailNotification(to, subject, body) {
            // In a real application, this would send an actual email
            // For demo purposes, we'll log it and show a notification
            console.log('Email sent:', { to, subject, body });
            
            // Store notification
            const notification = {
                id: Date.now(),
                type: 'email',
                title: 'Email Sent',
                message: `Email notification sent to ${to}`,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            addNotification(notification);
            
            // Show in-app notification
            showNotification('Email notification sent', 'info');
        }

        function sendPasswordResetEmail(to, token) {
            const resetLink = `${window.location.origin}?reset_token=${token}`;
            const subject = 'TRAci Password Reset Request';
            const body = `
                <h2>Password Reset Request</h2>
                <p>You requested a password reset for your TRAci account.</p>
                <p>Click the link below to reset your password:</p>
                <p><a href="${resetLink}">Reset Password</a></p>
                <p>This link will expire in 24 hours.</p>
                <p>If you didn't request this, please ignore this email.</p>
                <br>
                <p><strong>TRAci Clinical Innovation Platform</strong></p>
            `;
            
            sendEmailNotification(to, subject, body);
        }

        // ========== NOTIFICATION SYSTEM ==========
        function addNotification(notification) {
            dashboardData.notifications.unshift(notification);
            updateNotificationBadge();
            
            // Store in localStorage
            localStorage.setItem('traci_notifications', JSON.stringify(dashboardData.notifications));
        }

        function updateNotificationBadge() {
            const unreadCount = dashboardData.notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationCount');
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 9 ? '9+' : unreadCount.toString();
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function loadNotifications() {
            const stored = localStorage.getItem('traci_notifications');
            if (stored) {
                try {
                    dashboardData.notifications = JSON.parse(stored);
                    updateNotificationBadge();
                } catch (e) {
                    console.error('Error loading notifications:', e);
                }
            }
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `message ${type}`;
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '10000';
            notification.style.maxWidth = '300px';
            notification.style.display = 'block';
            
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        // ========== ACTIVITY LOGGING ==========
        function logActivity(action, details) {
            const activity = {
                id: Date.now(),
                userId: currentUser?.id || 'anonymous',
                userName: currentUser?.name || 'Anonymous',
                action: action,
                details: details,
                timestamp: new Date().toISOString(),
                ip: '127.0.0.1', // In real app, get from request
                userAgent: navigator.userAgent
            };
            
            dashboardData.activities.unshift(activity);
            
            // Store in localStorage
            localStorage.setItem('traci_activities', JSON.stringify(dashboardData.activities));
            
            // Add notification for significant activities
            if (['login', 'logout', 'password_reset', 'account_locked'].includes(action)) {
                addNotification({
                    id: Date.now(),
                    type: 'security',
                    title: 'Security Event',
                    message: `${action}: ${details}`,
                    timestamp: new Date().toISOString(),
                    read: false
                });
            }
        }

        function loadActivities() {
            const stored = localStorage.getItem('traci_activities');
            if (stored) {
                try {
                    dashboardData.activities = JSON.parse(stored);
                } catch (e) {
                    console.error('Error loading activities:', e);
                }
            }
        }

        // ========== UI UPDATES ==========
        function updateAuthUI() {
            const loginBtn = document.getElementById('loginBtn');
            const userProfile = document.getElementById('userProfile');
            const statusPanel = document.getElementById('statusPanel');
            const adminControls = document.getElementById('adminControls');
            const guestWelcome = document.getElementById('guestWelcome');
            const loginRequired = document.getElementById('loginRequiredSection');
            const statsContainer = document.getElementById('statsContainer');
            const contentGrid = document.getElementById('contentGrid');
            const filterControls = document.getElementById('filterControls');
            const notificationBadge = document.getElementById('notificationBadge');
            
            if (currentUser) {
                // User is logged in
                loginBtn.classList.add('hidden');
                userProfile.classList.remove('hidden');
                statusPanel.classList.remove('hidden');
                notificationBadge.classList.remove('hidden');
                
                // Update user info
                document.getElementById('userAvatar').textContent = 
                    currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
                document.getElementById('currentUsername').textContent = currentUser.name;
                document.getElementById('currentUserRole').textContent = currentUser.role;
                document.getElementById('currentUserRole').className = `user-role ${currentUser.role}`;
                
                // Show/hide sections based on role
                if (currentUser.role === 'guest') {
                    guestWelcome.classList.remove('hidden');
                    adminControls.classList.add('hidden');
                    loginRequired.classList.add('hidden');
                } else {
                    guestWelcome.classList.add('hidden');
                    loginRequired.classList.add('hidden');
                    
                    if (currentUser.role === 'admin') {
                        adminControls.classList.remove('hidden');
                    } else {
                        adminControls.classList.add('hidden');
                    }
                }
                
                // Show main content
                statsContainer.classList.remove('hidden');
                contentGrid.classList.remove('hidden');
                filterControls.classList.remove('hidden');
                
            } else {
                // User is not logged in
                loginBtn.classList.remove('hidden');
                userProfile.classList.add('hidden');
                statusPanel.classList.add('hidden');
                adminControls.classList.add('hidden');
                guestWelcome.classList.add('hidden');
                notificationBadge.classList.add('hidden');
                
                // Show login required for protected content
                loginRequired.classList.remove('hidden');
                statsContainer.classList.add('hidden');
                contentGrid.classList.add('hidden');
                filterControls.classList.add('hidden');
            }
            
            // Update mobile nav
            updateMobileNav();
        }

        function updateMobileNav() {
            const mobileNavContent = document.getElementById('mobileNavContent');
            if (!mobileNavContent) return;
            
            let html = '';
            
            if (currentUser) {
                // User is logged in
                html += `
                    <div style="padding: var(--space-md); background: var(--bg-primary); border-radius: var(--radius-md); margin-bottom: var(--space-md);">
                        <div style="display: flex; align-items: center; gap: var(--space-md);">
                            <div class="user-avatar">${currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)}</div>
                            <div>
                                <div style="font-weight: 600; font-size: 14px; color: var(--text-primary);">${currentUser.name}</div>
                                <div class="user-role ${currentUser.role}" style="font-size: 11px;">${currentUser.role}</div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="admin-btn w-full" onclick="showModal(\'activityModal\'); closeMobileNav();">
                        <i class="mdi mdi-chart-line"></i>
                        <span>Activity</span>
                    </button>
                `;
                
                if (currentUser.role === 'admin') {
                    html += `
                        <button class="admin-btn w-full" onclick="showModal(\'manageUsersModal\'); closeMobileNav();">
                            <i class="mdi mdi-account-multiple"></i>
                            <span>Manage Users</span>
                        </button>
                        <button class="admin-btn w-full" onclick="showModal(\'addProjectModal\'); closeMobileNav();">
                            <i class="mdi mdi-plus-circle"></i>
                            <span>Add Project</span>
                        </button>
                    `;
                }
                
                html += `
                    <div style="margin-top: var(--space-xl); padding-top: var(--space-md); border-top: 1px solid var(--border);">
                        <button class="admin-btn w-full" style="background: var(--danger-50); color: var(--danger-600); border-color: var(--danger-200);" onclick="logoutUser(); closeMobileNav();">
                            <i class="mdi mdi-logout"></i>
                            <span>Logout</span>
                        </button>
                    </div>
                `;
            } else {
                // User is not logged in
                html += `
                    <button class="admin-btn w-full" onclick="showModal(\'loginModal\'); closeMobileNav();">
                        <i class="mdi mdi-login"></i>
                        <span>Login</span>
                    </button>
                    <button class="admin-btn w-full" onclick="showModal(\'forgotPasswordModal\'); closeMobileNav();">
                        <i class="mdi mdi-lock-reset"></i>
                        <span>Reset Password</span>
                    </button>
                `;
            }
            
            mobileNavContent.innerHTML = html;
        }

        function closeMobileNav() {
            document.getElementById('mobileNav').classList.remove('open');
        }

        // ========== DASHBOARD FUNCTIONS ==========
        async function loadDashboard() {
            if (!currentUser) return;
            
            showLoadingState();
            
            try {
                // Load data
                await loadMockData();
                loadActivities();
                loadNotifications();
                
                // Update UI
                updateStats();
                renderDashboard();
                updateTimestamp();
                
                // Log activity
                logActivity('dashboard_viewed', 'User viewed dashboard');
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                showErrorState();
            }
        }

        async function loadMockData() {
            // Mock data for demonstration
            dashboardData.projects = [
                {
                    id: 1,
                    name: 'AI-Assisted Lung Nodule Detection',
                    description: 'Using deep learning to improve early detection of pulmonary nodules in CT scans.',
                    status: 'development',
                    progress: 65,
                    category: 'clinical_research',
                    priority: 'high',
                    visibility: 'public',
                    needs_feedback: true,
                    owner: 'Dr. Smith',
                    created_at: new Date().toISOString()
                },
                {
                    id: 2,
                    name: 'Tele-Rehabilitation for COPD Patients',
                    description: 'Remote monitoring and exercise program for chronic obstructive pulmonary disease patients.',
                    status: 'testing',
                    progress: 80,
                    category: 'quality_improvement',
                    priority: 'medium',
                    visibility: 'private',
                    needs_feedback: false,
                    owner: 'Dr. Johnson',
                    created_at: new Date().toISOString()
                }
            ];
            
            dashboardData.tools = [
                {
                    id: 1,
                    name: 'Pulmonary Function Test Analyzer',
                    description: 'Advanced analysis tool for pulmonary function tests with predictive analytics.',
                    url: 'https://example.com/pft',
                    status: 'operational',
                    category: 'clinical',
                    icon: 'mdi mdi-lung'
                },
                {
                    id: 2,
                    name: 'Research Data Warehouse',
                    description: 'Secure data repository for clinical research with built-in analytics.',
                    url: 'https://example.com/data',
                    status: 'maintenance',
                    category: 'research',
                    icon: 'mdi mdi-database'
                }
            ];
            
            dashboardData.users = [
                {
                    id: 1,
                    name: 'System Administrator',
                    email: 'admin@hospital.com',
                    role: 'admin',
                    department: 'Administration',
                    status: 'active'
                },
                {
                    id: 2,
                    name: 'Dr. Jane Smith',
                    email: 'doctor@hospital.com',
                    role: 'doctor',
                    department: 'Pulmonology',
                    status: 'active'
                }
            ];
            
            dashboardData.filteredProjects = [...dashboardData.projects];
        }

        function updateStats() {
            document.getElementById('toolsCount').textContent = dashboardData.tools.length;
            document.getElementById('projectsCount').textContent = dashboardData.projects.length;
            document.getElementById('commentsCount').textContent = '0'; // Would come from database
            document.getElementById('usersCount').textContent = dashboardData.users.length;
            
            // Update active sessions
            const activeSessions = dashboardData.activities.filter(a => 
                a.action === 'login' && 
                new Date(a.timestamp) > new Date(Date.now() - SESSION_TIMEOUT)
            ).length;
            document.getElementById('activeSessions').textContent = activeSessions;
            
            // Update locked accounts (simulated)
            document.getElementById('lockedAccounts').textContent = '0';
        }

        function renderDashboard() {
            renderTools();
            renderProjects();
        }

        function renderTools() {
            const toolsGrid = document.getElementById('toolsGrid');
            
            if (dashboardData.tools.length === 0) {
                toolsGrid.innerHTML = `
                    <div style="text-align: center; padding: var(--space-2xl); color: var(--text-muted);">
                        <i class="mdi mdi-toolbox-outline" style="font-size: 48px; margin-bottom: var(--space-md); opacity: 0.5;"></i>
                        <p>No tools available</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            dashboardData.tools.forEach(tool => {
                html += `
                    <div class="tool-card">
                        <div class="tool-header">
                            <div class="tool-icon-wrapper">
                                <i class="${tool.icon || 'mdi mdi-toolbox'}"></i>
                            </div>
                            <div style="flex: 1;">
                                <div class="tool-name">${tool.name}</div>
                                <div class="tool-description">${tool.description}</div>
                            </div>
                            <span class="tool-status ${tool.status}">${tool.status}</span>
                        </div>
                        <div class="tool-footer">
                            <a href="${tool.url}" target="_blank" class="tool-link">
                                <i class="mdi mdi-open-in-new"></i>
                                Access Tool
                            </a>
                            <span class="tool-category">${tool.category}</span>
                        </div>
                    </div>
                `;
            });
            
            toolsGrid.innerHTML = html;
        }

        function renderProjects() {
            const projectsList = document.getElementById('projectsList');
            
            if (dashboardData.filteredProjects.length === 0) {
                projectsList.innerHTML = `
                    <div style="text-align: center; padding: var(--space-2xl); color: var(--text-muted);">
                        <i class="mdi mdi-flask-outline" style="font-size: 48px; margin-bottom: var(--space-md); opacity: 0.5;"></i>
                        <p>No projects found</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            dashboardData.filteredProjects.forEach(project => {
                const canEdit = currentUser && 
                    (currentUser.role === 'admin' || 
                     (currentUser.role === 'doctor' && project.visibility !== 'admin_only'));
                
                html += `
                    <div class="project-card">
                        <div class="project-header">
                            <div class="project-title">
                                <i class="mdi mdi-flask"></i>
                                ${project.name}
                                ${project.visibility === 'private' ? 
                                    '<span style="font-size: 11px; background: var(--warning-50); color: var(--warning-600); padding: 2px 8px; border-radius: var(--radius-full); margin-left: 8px;">Private</span>' : ''}
                            </div>
                            <span class="project-status status-${project.status}">${project.status}</span>
                        </div>
                        <div class="project-description">${project.description}</div>
                        
                        <div class="project-progress">
                            <div class="progress-label">
                                <span>Progress</span>
                                <span>${project.progress}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${project.progress}%"></div>
                            </div>
                        </div>
                        
                        <div class="project-actions">
                            ${canEdit ? `
                                <button class="action-btn edit-btn" onclick="editProject(${project.id})">
                                    <i class="mdi mdi-pencil"></i>
                                    <span>Edit</span>
                                </button>
                            ` : ''}
                            <button class="action-btn comment-btn">
                                <i class="mdi mdi-comment"></i>
                                <span>Comments</span>
                            </button>
                            ${currentUser?.role === 'admin' ? `
                                <button class="action-btn delete-btn" onclick="deleteProject(${project.id})">
                                    <i class="mdi mdi-delete"></i>
                                    <span>Delete</span>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            projectsList.innerHTML = html;
        }

        // ========== HELPER FUNCTIONS ==========
        function showError(element, message) {
            element.textContent = message;
            element.style.display = 'block';
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function showSuccess(element, message) {
            element.textContent = message;
            element.style.display = 'block';
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function showModal(modalId) {
            hideAllModals();
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function hideAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.style.display = 'none';
            });
            document.body.style.overflow = 'auto';
        }

        function showLoadingState() {
            // Implement loading state
        }

        function showErrorState() {
            // Implement error state
        }

        function updateTimestamp() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit'
            });
            const dateString = now.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
            
            document.getElementById('lastUpdatedTime').textContent = `${dateString} ${timeString}`;
        }

        // ========== EVENT LISTENERS ==========
        function setupEventListeners() {
            // Track user activity
            document.addEventListener('click', updateActivity);
            document.addEventListener('keypress', updateActivity);
            document.addEventListener('scroll', updateActivity);
            document.addEventListener('mousemove', updateActivity);
            
            // Login button
            document.getElementById('loginBtn').addEventListener('click', () => showModal('loginModal'));
            document.getElementById('loginRequiredBtn').addEventListener('click', () => showModal('loginModal'));
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', () => logoutUser());
            
            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', () => {
                document.getElementById('mobileNav').classList.add('open');
            });
            
            document.getElementById('mobileNavClose').addEventListener('click', closeMobileNav);
            
            // Modal close buttons
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', hideAllModals);
            });
            
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) hideAllModals();
                });
            });
            
            // Login form
            document.getElementById('submitLogin').addEventListener('click', async () => {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                await loginUser(email, password);
            });
            
            // Remember me checkbox
            document.getElementById('rememberCheckbox').addEventListener('click', function() {
                this.classList.toggle('checked');
                rememberMe = this.classList.contains('checked');
            });
            
            // Password toggle
            document.getElementById('togglePassword').addEventListener('click', function() {
                const passwordInput = document.getElementById('loginPassword');
                const type = passwordInput.type === 'password' ? 'text' : 'password';
                passwordInput.type = type;
                this.innerHTML = type === 'password' ? '<i class="mdi mdi-eye"></i>' : '<i class="mdi mdi-eye-off"></i>';
            });
            
            // Forgot password
            document.getElementById('forgotPasswordLink').addEventListener('click', (e) => {
                e.preventDefault();
                hideAllModals();
                showModal('forgotPasswordModal');
            });
            
            document.getElementById('submitForgot').addEventListener('click', async () => {
                const email = document.getElementById('forgotEmail').value;
                await forgotPassword(email);
            });
            
            document.getElementById('backToLogin').addEventListener('click', (e) => {
                e.preventDefault();
                hideAllModals();
                showModal('loginModal');
            });
            
            // Reset password
            document.getElementById('submitReset').addEventListener('click', async () => {
                const token = document.getElementById('resetToken').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                await resetPassword(token, newPassword, confirmPassword);
            });
            
            // Admin buttons
            document.getElementById('addProjectBtn').addEventListener('click', () => showModal('addProjectModal'));
            document.getElementById('manageUsersBtn').addEventListener('click', () => showModal('manageUsersModal'));
            document.getElementById('activityDashboardBtn').addEventListener('click', () => showModal('activityModal'));
            
            // Activity button
            document.getElementById('activityBtn').addEventListener('click', () => showModal('activityModal'));
            
            // Notifications button
            document.getElementById('notificationsBtn').addEventListener('click', () => showModal('notificationsModal'));
            
            // Guest buttons
            document.getElementById('guestContactBtn').addEventListener('click', () => {
                window.open('mailto:pneumology.innovation@hospital.com?subject=TRAci Platform Inquiry');
            });
            
            document.getElementById('guestLearnBtn').addEventListener('click', () => {
                alert('TRAci Platform Overview:\n\nâ€¢ Clinical Tools & Resources\nâ€¢ Research Project Management\nâ€¢ Secure Collaboration\nâ€¢ HIPAA Compliant');
            });
            
            // Refresh link
            document.getElementById('refreshLink').addEventListener('click', async (e) => {
                e.preventDefault();
                if (currentUser) {
                    await loadDashboard();
                    showNotification('Data refreshed successfully', 'success');
                }
            });
            
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filter = this.dataset.filter;
                    // Implement filtering logic
                    console.log('Filter:', filter);
                });
            });
            
            // Check for password reset token in URL
            const urlParams = new URLSearchParams(window.location.search);
            const resetToken = urlParams.get('reset_token');
            if (resetToken) {
                document.getElementById('resetToken').value = resetToken;
                showModal('resetPasswordModal');
            }
        }

        // ========== GLOBAL FUNCTIONS ==========
        window.editProject = function(projectId) {
            const project = dashboardData.projects.find(p => p.id === projectId);
            if (project) {
                document.getElementById('editProjectId').value = project.id;
                document.getElementById('editProjectName').value = project.name;
                document.getElementById('editProjectDescription').value = project.description;
                document.getElementById('editProjectStatus').value = project.status;
                document.getElementById('editProjectProgress').value = project.progress;
                showModal('editProjectModal');
            }
        };

        window.deleteProject = function(projectId) {
            if (confirm('Are you sure you want to delete this project?')) {
                dashboardData.projects = dashboardData.projects.filter(p => p.id !== projectId);
                dashboardData.filteredProjects = [...dashboardData.projects];
                renderProjects();
                updateStats();
                showNotification('Project deleted successfully', 'success');
                logActivity('project_deleted', `Deleted project ${projectId}`);
            }
        };
    </script>
</body>
</html>
